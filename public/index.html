<!DOCTYPE html>
<html>
<head>
    <title>üöÄ USACO Code Runner - Monaco Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .problem-selector {
            margin-bottom: 25px;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        #editor-container {
            width: 100%;
            height: 500px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .runtime-input-section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
            transition: border-color 0.3s ease;
        }

        .runtime-input-section:hover {
            border-color: #d0d0d0;
        }

        .runtime-input-label {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .runtime-input-label span {
            margin-right: 10px;
        }

        .runtime-input {
            width: 100%;
            height: 150px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            box-sizing: border-box;
            transition: all 0.3s ease;
            line-height: 1.5;
            background: #fafafa;
        }

        .runtime-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .runtime-input::placeholder {
            color: #999;
            font-style: italic;
        }

        .runtime-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 14px 40px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .run-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .run-btn:active {
            transform: translateY(0);
        }

        .sample-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
            padding: 10px 20px;
            font-size: 14px;
        }

        .sample-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
        }

        .clear-btn {
            background: linear-gradient(135deg, #f44336 0%, #e53935 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
        }

        .clear-btn:active {
            transform: translateY(0);
        }

        .output-section {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            background: #fafafa;
            min-height: 150px;
            max-height: 500px;
            overflow-y: auto;
            transition: border-color 0.3s ease;
        }

        .output-section:hover {
            border-color: #d0d0d0;
        }

        .output-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .output-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.7;
            color: #333;
        }

        .error {
            color: #c62828;
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #c62828;
        }

        .info {
            color: #667eea;
            font-weight: 500;
        }

        .success {
            color: #2e7d32;
            font-weight: bold;
        }

        .status-message {
            text-align: center;
            padding: 20px;
            font-size: 14px;
        }

        .keyboard-hint {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(102, 126, 234, 0.1);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #667eea;
        }

        .kbd {
            background: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .problem-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .editor-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .editor-language {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>üöÄ USACO Code Runner - Monaco Editor</h2>

        <div class="problem-selector">
            <label class="input-label">üìö Select USACO Problem:</label>
            <select id="problemSelect" onchange="loadProblem()" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 8px;">
                <option value="">-- Select a problem --</option>
                <option value="usaco1">USACO 1: Maximum Array Value</option>
                <option value="usaco2">USACO 2: Milk Pails</option>
                <option value="usaco3">USACO 3: The Clocks</option>
                <option value="custom">Custom Code</option>
            </select>
        </div>

        <div id="problemTitle" class="problem-title" style="display: none;"></div>

        <div class="input-section">
            <label class="input-label">üíª Java Code</label>
            <div id="editor-container"></div>
            <div class="editor-controls">
                <span class="editor-language">Java</span>
            </div>
        </div>

        <div class="runtime-input-section">
            <label class="runtime-input-label">
                <span>üìù</span> Runtime Input
            </label>
            <textarea id="runtimeInput" class="runtime-input" rows="6" placeholder="Enter input for your Java code (e.g., sample input):
5
10 4 12 7 15"></textarea>
            <div class="runtime-hint">
                <span class="keyboard-hint"><span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> to run</span>
            </div>
        </div>

        <div class="buttons-container">
            <button id="sampleBtn1" class="sample-btn" onclick="loadSample(1)">üì• Load Sample 1</button>
            <button id="sampleBtn2" class="sample-btn" onclick="loadSample(2)">üì• Load Sample 2</button>
            <button id="sampleBtn3" class="sample-btn" onclick="loadSample(3)">üì• Load Sample 3</button>
            <button id="runBtn" class="run-btn" onclick="runJavaCode()">‚ñ∂ Run Code</button>
            <button id="clearBtn" class="clear-btn" onclick="clearOutput()">üóë Clear Output</button>
        </div>

        <div class="output-section">
            <div class="output-label">üíª Output:</div>
            <div id="output" class="output-content">
                <span class="status-message" style="color: #667eea;">üëã Select a USACO problem or write your own code. Click "Run Code" or press Ctrl+Enter.</span>
            </div>
        </div>
    </div>

    <script>
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});

        let editor;

        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: `import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        // Read input
        int n = scanner.nextInt();

        int[] array = new int[n];
        for (int i = 0; i < n; i++) {
            array[i] = scanner.nextInt();
        }

        // Process your input here

        scanner.close();
    }
}`,
                language: 'java',
                theme: 'vs-light',
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                fontFamily: 'Consolas, "Courier New", monospace',
                lineNumbers: 'on',
                renderLineHighlight: 'all',
                scrollBeyondLastLine: false,
                tabSize: 4,
                wordWrap: 'on',
                padding: { top: 16, bottom: 16 },
                roundedSelection: false,
                lineDecorationsWidth: 0,
                lineNumbersMinChars: 4
            });

            // Allow Ctrl+Enter to run code
            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, function() {
                runJavaCode();
            });
        });

        // Problem data
        const problems = {
            usaco1: {
                title: "USACO 1: Maximum Array Value",
                code: `import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        // Read input
        int n = scanner.nextInt();

        int[] array = new int[n];
        for (int i = 0; i < n; i++) {
            array[i] = scanner.nextInt();
        }

        // Find the maximum
        int max = array[0];
        for (int i = 1; i < n; i++) {
            if (array[i] > max) {
                max = array[i];
            }
        }

        System.out.println(max);
    }
}`
            },
            usaco2: {
                title: "USACO 2: Milk Pails",
                code: `import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        int X = scanner.nextInt();
        int Y = scanner.nextInt();
        int M = scanner.nextInt();

        int max = 0;

        // Try all possible numbers of pails of size X
        for (int i = 0; i <= M / X; i++) {
            int remaining = M - i * X;
            if (remaining < 0) break;

            // Try all possible numbers of pails of size Y
            for (int j = 0; j <= remaining / Y; j++) {
                int total = i * X + j * Y;
                if (total <= M && total > max) {
                    max = total;
                }
            }
        }

        System.out.println(max);
    }
}`
            },
            usaco3: {
                title: "USACO 3: The Clocks",
                code: `import java.util.Scanner;
import java.util.Arrays;

public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        // Read the 9 clock positions
        int[] clocks = new int[9];
        for (int i = 0; i < 9; i++) {
            clocks[i] = scanner.nextInt() / 3;
        }

        int[] moves = new int[9];
        Arrays.fill(moves, -1);

        // BFS to find minimum moves
        int[] dx = {0, 3, 6, 0, 1, 2, 0, 3, 6};
        int[] dy = {3, 0, 0, 1, 1, 1, 2, 2, 2};

        solve(clocks, moves);

        StringBuilder result = new StringBuilder();
        for (int i = 0; i < 9; i++) {
            if (moves[i] > 0) {
                result.append(moves[i]);
                result.append(" ");
            }
        }

        System.out.println(result.toString().trim());
    }

    static void solve(int[] clocks, int[] moves) {
        int[] dx = {0, 3, 6, 0, 1, 2, 0, 3, 6};
        int[] dy = {3, 0, 0, 1, 1, 1, 2, 2, 2};

        if (isAll(clocks, 4)) {
            return;
        }

        for (int i = 0; i < 9; i++) {
            if (moves[i] < 0) {
                moves[i] = 0;

                for (int j = 0; j < 4; j++) {
                    int x = dx[i] + j * dy[i];
                    clocks[x] = (clocks[x] + 1) % 4;
                }

                solve(clocks, moves);

                if (isAll(clocks, 4)) {
                    moves[i]++;
                    return;
                }

                for (int j = 0; j < 4; j++) {
                    int x = dx[i] + j * dy[i];
                    clocks[x] = (clocks[x] + 3) % 4;
                }

                moves[i] = -1;
            }
        }
    }

    static boolean isAll(int[] clocks, int target) {
        for (int clock : clocks) {
            if (clock != target) {
                return false;
            }
        }
        return true;
    }
}`
            }
        };

        const sampleInputs = {
            usaco1: [
                "5\n10 4 12 7 15",
                "3\n1 2 3",
                "4\n100 1 1 100"
            ],
            usaco2: [
                "8 4 24",
                "3 6 9",
                "5 3 20"
            ],
            usaco3: [
                "0 3 0 3 0 3 0 3 0",
                "0 0 0 0 0 0 0 0 0",
                "0 1 0 1 0 1 0 1 0"
            ]
        };

        const sampleOutputs = {
            usaco1: [
                "15",
                "3",
                "100"
            ],
            usaco2: [
                "24",
                "6",
                "5"
            ],
            usaco3: [
                "0 1 2",
                "1 2 3",
                "0 1 2"
            ]
        };

        function loadProblem() {
            const select = document.getElementById('problemSelect');
            const problemTitle = document.getElementById('problemTitle');
            const sampleBtns = [
                document.getElementById('sampleBtn1'),
                document.getElementById('sampleBtn2'),
                document.getElementById('sampleBtn3')
            ];

            if (select.value === 'custom') {
                problemTitle.style.display = 'none';
                sampleBtns.forEach(btn => btn.disabled = false);
                return;
            }

            if (select.value && problems[select.value]) {
                problemTitle.textContent = problems[select.value].title;
                problemTitle.style.display = 'block';
                if (editor) {
                    editor.setValue(problems[select.value].code);
                }
                sampleBtns.forEach(btn => btn.disabled = false);
            }
        }

        function loadSample(num) {
            const select = document.getElementById('problemSelect');
            const runtimeInput = document.getElementById('runtimeInput');

            if (select.value === 'custom' || !problems[select.value]) {
                alert('Please select a USACO problem first!');
                return;
            }

            const samples = sampleInputs[select.value];
            const outputs = sampleOutputs[select.value];

            if (num <= samples.length) {
                runtimeInput.value = samples[num - 1];
                document.getElementById('output').innerHTML = `<span class="info">üì• Sample ${num} input loaded. Click "Run Code" to see output.</span>`;
            }
        }

        async function runJavaCode() {
            if (!editor) {
                alert('Editor is still loading. Please wait a moment and try again.');
                return;
            }

            const code = editor.getValue();
            const runtimeInput = document.getElementById('runtimeInput').value;
            const outputDiv = document.getElementById('output');

            if (!code.trim()) {
                outputDiv.innerHTML = '<span class="error">‚ö†Ô∏è Please enter some Java code first!</span>';
                return;
            }

            outputDiv.innerHTML = '<span class="status-message">‚è≥ Running code... Please wait...</span>';

            try {
                const response = await fetch('/api/run-java', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code, input: runtimeInput })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    const output = result.stdout || result.stderr || '‚úÖ Code executed successfully!';
                    outputDiv.innerHTML = output
                        .split('\n')
                        .map(line => `<div>${escapeHtml(line)}</div>`)
                        .join('');
                } else {
                    const error = result.error || 'Unknown error occurred';
                    outputDiv.innerHTML = `<div class="error">‚ùå Compilation/Execution Error:<br><br>${escapeHtml(error)}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                outputDiv.innerHTML = `<div class="error">‚ùå Error: ${escapeHtml(error.message)}</div>`;
            }
        }

        function clearOutput() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '<span class="status-message" style="color: #667eea;">üëã Output cleared. Ready for new code!</span>';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load custom by default
        document.getElementById('problemSelect').value = 'custom';
        loadProblem();
    </script>
</body>
</html>